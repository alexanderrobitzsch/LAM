<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Bayesian Model Estimation with Adaptive Metropolis Hastings Sampling
(<code>amh</code>) or Penalized Maximum Likelihood Estimation (<code>pmle</code>) — amh • LAM</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Bayesian Model Estimation with Adaptive Metropolis Hastings Sampling
(<code>amh</code>) or Penalized Maximum Likelihood Estimation (<code>pmle</code>) — amh" />
<meta property="og:description" content="The function amh conducts a Bayesian statistical analysis using
the adaptive Metropolis-Hastings
as the estimation procedure (Hoff, 2009; Roberts &amp;amp; Rosenthal, 2001). Only univariate prior
distributions are allowed.
Note that this function is intended just for experimental purpose, not to
replace general purpose packages like WinBUGS, JAGS,
Stan or MHadaptive. 
The function pmle optimizes the penalized likelihood (Cole, Chu &amp;amp; Greenland, 2014)
which means that
the posterior is maximized and the maximum a posterior estimate is
obtained. The optimization functions stats::optim or
stats::nlminb can be used." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">LAM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Versions">0.7-vv</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/alexanderrobitzsch/LAM/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Bayesian Model Estimation with Adaptive Metropolis Hastings Sampling
(<code>amh</code>) or Penalized Maximum Likelihood Estimation (<code>pmle</code>)</h1>
    
    <div class="hidden name"><code>amh.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function <code>amh</code> conducts a Bayesian statistical analysis using
the adaptive Metropolis-Hastings
as the estimation procedure (Hoff, 2009; Roberts &amp; Rosenthal, 2001). Only univariate prior
distributions are allowed.
Note that this function is intended just for experimental purpose, not to
replace general purpose packages like <span class="pkg">WinBUGS</span>, <span class="pkg">JAGS</span>,
<span class="pkg">Stan</span> or <span class="pkg">MHadaptive</span>. <br /></p>
<p>The function <code>pmle</code> optimizes the penalized likelihood (Cole, Chu &amp; Greenland, 2014)
which means that
the posterior is maximized and the maximum a posterior estimate is
obtained. The optimization functions <a href='https://rdrr.io/r/stats/optim.html'>stats::optim</a> or
<a href='https://rdrr.io/r/stats/nlminb.html'>stats::nlminb</a> can be used.</p>
    </div>

    <pre class="usage"><span class='fu'>amh</span>(<span class='no'>data</span>, <span class='no'>nobs</span>, <span class='no'>pars</span>, <span class='no'>model</span>,  <span class='no'>prior</span>, <span class='no'>proposal_sd</span>,  <span class='kw'>pars_lower</span><span class='kw'>=</span><span class='kw'>NULL</span>,
      <span class='kw'>pars_upper</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>derivedPars</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>n.iter</span><span class='kw'>=</span><span class='fl'>5000</span>, <span class='kw'>n.burnin</span><span class='kw'>=</span><span class='fl'>1000</span>,
      <span class='kw'>n.sims</span><span class='kw'>=</span><span class='fl'>3000</span>, <span class='kw'>acceptance_bounds</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>.45</span>,<span class='fl'>.55</span>), <span class='kw'>proposal_refresh</span><span class='kw'>=</span><span class='fl'>50</span>,
      <span class='kw'>proposal_equal</span><span class='kw'>=</span><span class='fl'>4</span>, <span class='kw'>print_iter</span><span class='kw'>=</span><span class='fl'>50</span>, <span class='kw'>boundary_ignore</span><span class='kw'>=</span><span class='fl'>FALSE</span> )

<span class='fu'>pmle</span>( <span class='no'>data</span>, <span class='no'>nobs</span>, <span class='no'>pars</span>, <span class='no'>model</span>,  <span class='kw'>prior</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>model_grad</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>pars_lower</span><span class='kw'>=</span><span class='kw'>NULL</span>,
      <span class='kw'>pars_upper</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>method</span><span class='kw'>=</span><span class='st'>"L-BFGS-B"</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(), <span class='kw'>verbose</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>hessian</span><span class='kw'>=</span><span class='fl'>TRUE</span>,
      <span class='kw'>optim_fct</span><span class='kw'>=</span><span class='st'>"nlminb"</span>, <span class='kw'>h</span><span class='kw'>=</span><span class='fl'>1e-4</span>, <span class='no'>...</span> )

<span class='co'># S3 method for amh</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>object</span>, <span class='kw'>digits</span><span class='kw'>=</span><span class='fl'>3</span>, <span class='kw'>file</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='co'># S3 method for amh</span>
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>x</span>, <span class='kw'>conflevel</span><span class='kw'>=</span><span class='fl'>.95</span>, <span class='kw'>digits</span><span class='kw'>=</span><span class='fl'>3</span>, <span class='kw'>lag.max</span><span class='kw'>=</span><span class='fl'>.1</span>,
    <span class='kw'>col.smooth</span><span class='kw'>=</span><span class='st'>"red"</span>, <span class='kw'>lwd.smooth</span><span class='kw'>=</span><span class='fl'>2</span>, <span class='kw'>col.split</span><span class='kw'>=</span><span class='st'>"blue"</span>, <span class='kw'>lwd.split</span><span class='kw'>=</span><span class='fl'>2</span>,
    <span class='kw'>lty.split</span><span class='kw'>=</span><span class='fl'>1</span>, <span class='kw'>col.ci</span><span class='kw'>=</span><span class='st'>"orange"</span>, <span class='kw'>cex.summ</span><span class='kw'>=</span><span class='fl'>1</span>, <span class='kw'>ask</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='no'>...</span> )

<span class='co'># S3 method for amh</span>
<span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span>(<span class='no'>object</span>, <span class='no'>...</span>)

<span class='co'># S3 method for amh</span>
<span class='fu'><a href='https://rdrr.io/r/stats/logLik.html'>logLik</a></span>(<span class='no'>object</span>, <span class='no'>...</span>)

<span class='co'># S3 method for amh</span>
<span class='fu'><a href='https://rdrr.io/r/stats/vcov.html'>vcov</a></span>(<span class='no'>object</span>, <span class='no'>...</span>)

<span class='co'># S3 method for amh</span>
<span class='fu'><a href='https://rdrr.io/r/stats/confint.html'>confint</a></span>(<span class='no'>object</span>, <span class='no'>parm</span>, <span class='kw'>level</span><span class='kw'>=</span><span class='fl'>.95</span>, <span class='no'>...</span> )

<span class='co'># S3 method for pmle</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>object</span>, <span class='kw'>digits</span><span class='kw'>=</span><span class='fl'>3</span>, <span class='kw'>file</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='co'># S3 method for pmle</span>
<span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span>(<span class='no'>object</span>, <span class='no'>...</span>)

<span class='co'># S3 method for pmle</span>
<span class='fu'><a href='https://rdrr.io/r/stats/logLik.html'>logLik</a></span>(<span class='no'>object</span>, <span class='no'>...</span>)

<span class='co'># S3 method for pmle</span>
<span class='fu'><a href='https://rdrr.io/r/stats/vcov.html'>vcov</a></span>(<span class='no'>object</span>, <span class='no'>...</span>)

<span class='co'># S3 method for pmle</span>
<span class='fu'><a href='https://rdrr.io/r/stats/confint.html'>confint</a></span>(<span class='no'>object</span>, <span class='no'>parm</span>, <span class='kw'>level</span><span class='kw'>=</span><span class='fl'>.95</span>, <span class='no'>...</span> )</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>Object which contains data</p></td>
    </tr>
    <tr>
      <th>nobs</th>
      <td><p>Number of observations</p></td>
    </tr>
    <tr>
      <th>pars</th>
      <td><p>Named vector of initial values for parameters</p></td>
    </tr>
    <tr>
      <th>model</th>
      <td><p>Function defining the log-likelihood of the model</p></td>
    </tr>
    <tr>
      <th>prior</th>
      <td><p>List with prior distributions for the parameters to be sampled (see Examples).
See <code><a href='https://rdrr.io/pkg/sirt/man/prior_model_parse.html'>sirt::prior_model_parse</a></code>
for more convenient specifications of the prior distributions. Setting the prior
argument to <code>NULL</code> corresponds to improper (constant) prior distributions
for all parameters.</p></td>
    </tr>
    <tr>
      <th>proposal_sd</th>
      <td><p>Vector with initial standard deviations for proposal distribution</p></td>
    </tr>
    <tr>
      <th>pars_lower</th>
      <td><p>Vector with lower bounds for parameters</p></td>
    </tr>
    <tr>
      <th>pars_upper</th>
      <td><p>Vector with upper bounds for parameters</p></td>
    </tr>
    <tr>
      <th>derivedPars</th>
      <td><p>Optional list containing derived parameters from sampled chain</p></td>
    </tr>
    <tr>
      <th>n.iter</th>
      <td><p>Number of iterations</p></td>
    </tr>
    <tr>
      <th>n.burnin</th>
      <td><p>Number of burn-in iterations</p></td>
    </tr>
    <tr>
      <th>n.sims</th>
      <td><p>Number of sampled iterations for parameters</p></td>
    </tr>
    <tr>
      <th>acceptance_bounds</th>
      <td><p>Bounds for acceptance probabilities of sampled parameters</p></td>
    </tr>
    <tr>
      <th>proposal_refresh</th>
      <td><p>Number of iterations for computation of adaptation of proposal
standard deviation</p></td>
    </tr>
    <tr>
      <th>proposal_equal</th>
      <td><p>Number of intervals in which the proposal SD should be constant
for fixing the SD</p></td>
    </tr>
    <tr>
      <th>print_iter</th>
      <td><p>Display progress every <code>print_iter</code>th iteration</p></td>
    </tr>
    <tr>
      <th>boundary_ignore</th>
      <td><p>Logical indicating whether sampled values outside the
specified boundaries should be ignored.</p></td>
    </tr>
    <tr>
      <th>model_grad</th>
      <td><p>Optional function which evaluates the gradient of
the log-likelihood function (must be a function of <code>pars</code>.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>Optimization method in <code><a href='https://rdrr.io/r/stats/optim.html'>stats::optim</a></code></p></td>
    </tr>
    <tr>
      <th>control</th>
      <td><p>Control parameters <code><a href='https://rdrr.io/r/stats/optim.html'>stats::optim</a></code></p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Logical indicating whether progress should be displayed.</p></td>
    </tr>
    <tr>
      <th>hessian</th>
      <td><p>Logical indicating whether the Hessian matrix
should be computed</p></td>
    </tr>
    <tr>
      <th>optim_fct</th>
      <td><p>Type of optimization: <code>"optim"</code> (<a href='https://rdrr.io/r/stats/optim.html'>stats::optim</a>)
or the default <code>"nlminb"</code> (<a href='https://rdrr.io/r/stats/nlminb.html'>stats::nlminb</a>)</p></td>
    </tr>
    <tr>
      <th>h</th>
      <td><p>Numerical differentiation parameter for prior distributions if
<code>model_grad</code> is provided.</p></td>
    </tr>
    <tr>
      <th>object</th>
      <td><p>Object of class <code>amh</code></p></td>
    </tr>
    <tr>
      <th>digits</th>
      <td><p>Number of digits used for rounding</p></td>
    </tr>
    <tr>
      <th>file</th>
      <td><p>File name</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Further arguments to be passed</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>Object of class <code>amh</code></p></td>
    </tr>
    <tr>
      <th>conflevel</th>
      <td><p>Confidence level</p></td>
    </tr>
    <tr>
      <th>lag.max</th>
      <td><p>Percentage of iterations used for calculation of
autocorrelation function</p></td>
    </tr>
    <tr>
      <th>col.smooth</th>
      <td><p>Color moving average</p></td>
    </tr>
    <tr>
      <th>lwd.smooth</th>
      <td><p>Line thickness moving average</p></td>
    </tr>
    <tr>
      <th>col.split</th>
      <td><p>Color split chain</p></td>
    </tr>
    <tr>
      <th>lwd.split</th>
      <td><p>Line thickness splitted chain</p></td>
    </tr>
    <tr>
      <th>lty.split</th>
      <td><p>Line type splitted chain</p></td>
    </tr>
    <tr>
      <th>col.ci</th>
      <td><p>Color confidence interval</p></td>
    </tr>
    <tr>
      <th>cex.summ</th>
      <td><p>Point size summary</p></td>
    </tr>
    <tr>
      <th>ask</th>
      <td><p>Logical. If <code>TRUE</code> the user is asked for input,
before a new figure is drawn.</p></td>
    </tr>
    <tr>
      <th>parm</th>
      <td><p>Optional vector of parameters.</p></td>
    </tr>
    <tr>
      <th>level</th>
      <td><p>Confidence level.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>List of class <code>amh</code> including entries</p>
<dt>pars_chain</dt><dd><p>Data frame with sampled parameters</p></dd>
<dt>acceptance_parameters</dt><dd><p>Acceptance probabilities</p></dd>
<dt>amh_summary</dt><dd><p>Summary of parameters</p></dd>
<dt>coef</dt><dd><p>Coefficient obtained from marginal MAP estimation</p></dd>
<dt>pmle_pars</dt><dd><p>Object of parameters and posterior values corresponding
to multivariate maximum of posterior distribution.</p></dd>
<dt>comp_estimators</dt><dd><p>Estimates for univariate MAP, multivariate MAP
and mean estimator and corresponding posterior estimates.</p></dd>
<dt>ic</dt><dd><p>Information criteria</p></dd>
<dt>mcmcobj</dt><dd><p>Object of class <code>mcmc</code> for <span class="pkg">coda</span> package</p></dd>
<dt>proposal_sd</dt><dd><p>Used proposal standard deviations</p></dd>
<dt>proposal_sd_history</dt><dd><p>History of proposal standard
deviations during burn-in iterations</p></dd>
<dt>acceptance_rates_history</dt><dd><p>History of acceptance rates for all parameters
during burn-in phase</p></dd>
<dt>...</dt><dd><p>More values</p></dd>  

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Cole, S. R., Chu, H., &amp; Greenland, S. (2013). Maximum likelihood, profile likelihood,
and penalized likelihood: a primer. <em>American Journal of Epidemiology, 179</em>(2), 252-260.
doi: <a href='https://doi.org/10.1093/aje/kwt245'>10.1093/aje/kwt245</a></p>
<p>Hoff, P. D. (2009). <em>A first course in Bayesian statistical methods</em>.
New York: Springer.</p>
<p>Roberts, G. O., &amp; Rosenthal, J. S. (2001). Optimal scaling for various Metropolis-Hastings
algorithms. <em>Statistical Science, 16</em>(4), 351-367.
doi: <a href='https://doi.org/10.1214/ss/1015346320'>10.1214/ss/1015346320</a></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>See the Bayesian CRAN Task View for lot of information about
alternative <span style="R">R</span> packages.</p>
<p><code><a href='https://rdrr.io/pkg/sirt/man/prior_model_parse.html'>sirt::prior_model_parse</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 1: Constrained multivariate normal distribution</span>
<span class='co'>#############################################################################</span>

<span class='co'>#--- simulate data</span>
<span class='no'>Sigma</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(
    <span class='fl'>1</span>, <span class='fl'>.55</span>, <span class='fl'>.5</span>,
    <span class='fl'>.55</span>, <span class='fl'>1</span>, <span class='fl'>.45</span>,
    <span class='fl'>.5</span>, <span class='fl'>.45</span>, <span class='fl'>1</span> ), <span class='kw'>nrow</span><span class='kw'>=</span><span class='fl'>3</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>3</span>, <span class='kw'>byrow</span><span class='kw'>=</span><span class='fl'>TRUE</span> )
<span class='no'>mu</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>,<span class='fl'>1</span>,<span class='fl'>1.2</span>)
<span class='no'>N</span> <span class='kw'>&lt;-</span> <span class='fl'>400</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>9875</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>MASS</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/MASS/man/mvrnorm.html'>mvrnorm</a></span>( <span class='no'>N</span>, <span class='no'>mu</span>, <span class='no'>Sigma</span> )
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>dat</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>(<span class='st'>"Y"</span>,<span class='fl'>1</span>:<span class='fl'>3</span>)
<span class='no'>S</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cov</a></span>(<span class='no'>dat</span>)
<span class='no'>M</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colMeans</a></span>(<span class='no'>dat</span>)

<span class='co'>#-- define maximum likelihood function for normal distribution</span>
<span class='no'>fit_ml</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>( <span class='no'>S</span>, <span class='no'>Sigma</span>, <span class='no'>M</span>, <span class='no'>mu</span>, <span class='no'>n</span>, <span class='no'>log</span><span class='kw'>=</span><span class='fl'>TRUE</span>){
    <span class='no'>Sigma1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/solve.html'>solve</a></span>(<span class='no'>Sigma</span>)
    <span class='no'>p</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>Sigma</span>)
    <span class='no'>det_Sigma</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/det.html'>det</a></span>( <span class='no'>Sigma</span> )
    <span class='no'>eps</span> <span class='kw'>&lt;-</span> <span class='fl'>1E-30</span>
    <span class='kw'>if</span> ( <span class='no'>det_Sigma</span> <span class='kw'>&lt;</span> <span class='no'>eps</span> ){
            <span class='no'>det_Sigma</span> <span class='kw'>&lt;-</span> <span class='no'>eps</span>
    }
    <span class='no'>l1</span> <span class='kw'>&lt;-</span> - <span class='no'>p</span> * <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span>( <span class='fl'>2</span>*<span class='no'>pi</span> ) - <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span>( <span class='no'>M</span> - <span class='no'>mu</span> ) <span class='kw'>%*%</span> <span class='no'>Sigma1</span> <span class='kw'>%*%</span> ( <span class='no'>M</span> - <span class='no'>mu</span> ) -
                  <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span>( <span class='no'>det_Sigma</span> )  - <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>( <span class='no'>Sigma1</span> <span class='kw'>%*%</span> <span class='no'>S</span> ) )
    <span class='no'>l1</span> <span class='kw'>&lt;-</span> <span class='no'>n</span>/<span class='fl'>2</span> * <span class='no'>l1</span>
    <span class='kw'>if</span> (! <span class='no'>log</span>){
        <span class='no'>l1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span>(<span class='no'>l1</span>)
    }
    <span class='no'>l1</span> <span class='kw'>&lt;-</span> <span class='no'>l1</span>[<span class='fl'>1</span>,<span class='fl'>1</span>]
    <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(<span class='no'>l1</span>)
}
<span class='co'># This likelihood function can be directly accessed by the loglike_mvnorm function.</span>

<span class='co'>#--- define data input</span>
<span class='no'>data</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='st'>"S"</span><span class='kw'>=</span><span class='no'>S</span>, <span class='st'>"M"</span><span class='kw'>=</span><span class='no'>M</span>, <span class='st'>"n"</span><span class='kw'>=</span><span class='no'>N</span> )

<span class='co'>#--- define list of prior distributions</span>
<span class='no'>prior</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>()
<span class='no'>prior</span><span class='kw'>[[</span><span class='st'>"mu1"</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='st'>"dnorm"</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>x</span><span class='kw'>=</span><span class='fl'>NA</span>, <span class='kw'>mean</span><span class='kw'>=</span><span class='fl'>0</span>, <span class='kw'>sd</span><span class='kw'>=</span><span class='fl'>1</span> ) )
<span class='no'>prior</span><span class='kw'>[[</span><span class='st'>"mu2"</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='st'>"dnorm"</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>x</span><span class='kw'>=</span><span class='fl'>NA</span>, <span class='kw'>mean</span><span class='kw'>=</span><span class='fl'>0</span>, <span class='kw'>sd</span><span class='kw'>=</span><span class='fl'>5</span> ) )
<span class='no'>prior</span><span class='kw'>[[</span><span class='st'>"sig1"</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='st'>"dunif"</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>x</span><span class='kw'>=</span><span class='fl'>NA</span>, <span class='fl'>0</span>, <span class='fl'>10</span> ) )
<span class='no'>prior</span><span class='kw'>[[</span><span class='st'>"rho"</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='st'>"dunif"</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>x</span><span class='kw'>=</span><span class='fl'>NA</span>,-<span class='fl'>1</span>, <span class='fl'>1</span>  ) )

<span class='co'>#** alternatively, one can specify the prior as a string and uses</span>
<span class='co'>#   the 'prior_model_parse' function</span>
<span class='no'>prior_model2</span> <span class='kw'>&lt;-</span> <span class='st'>"
   mu1 ~ dnorm(x=NA, mean=0, sd=1)
   mu2 ~ dnorm(x=NA, mean=0, sd=5)
   sig1 ~ dunif(x=NA, 0,10)
   rho ~ dunif(x=NA,-1,1)
   "</span>
<span class='co'># convert string</span>
<span class='no'>prior2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>sirt</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sirt/man/prior_model_parse.html'>prior_model_parse</a></span>( <span class='no'>prior_model2</span> )
<span class='no'>prior2</span>  <span class='co'># should be equal to prior</span>

<span class='co'>#--- define log likelihood function for model to be fitted</span>
<span class='no'>model</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>( <span class='no'>pars</span>, <span class='no'>data</span> ){
    <span class='co'># mean vector</span>
    <span class='no'>mu</span> <span class='kw'>&lt;-</span> <span class='no'>pars</span>[ <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"mu1"</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='st'>"mu2"</span>,<span class='fl'>2</span>) ) ]
    <span class='co'># covariance matrix</span>
    <span class='no'>m1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='no'>pars</span>[<span class='st'>"rho"</span>] * <span class='no'>pars</span>[<span class='st'>"sig1"</span>]^<span class='fl'>2</span>, <span class='fl'>3</span>, <span class='fl'>3</span> )
    <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>(<span class='no'>m1</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>( <span class='no'>pars</span>[<span class='st'>"sig1"</span>]^<span class='fl'>2</span>, <span class='fl'>3</span> )
    <span class='no'>Sigma</span> <span class='kw'>&lt;-</span> <span class='no'>m1</span>
    <span class='co'># evaluate log-likelihood</span>
    <span class='no'>ll</span> <span class='kw'>&lt;-</span> <span class='fu'>fit_ml</span>( <span class='kw'>S</span><span class='kw'>=</span><span class='no'>data</span>$<span class='no'>S</span>, <span class='kw'>Sigma</span><span class='kw'>=</span><span class='no'>Sigma</span>, <span class='kw'>M</span><span class='kw'>=</span><span class='no'>data</span>$<span class='no'>M</span>, <span class='kw'>mu</span><span class='kw'>=</span><span class='no'>mu</span>, <span class='kw'>n</span><span class='kw'>=</span><span class='no'>data</span>$<span class='no'>n</span>)
    <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(<span class='no'>ll</span>)
}

<span class='co'>#--- initial parameter values</span>
<span class='no'>pars</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>2</span>,<span class='fl'>2</span>,<span class='fl'>0</span>)
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>pars</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"mu1"</span>, <span class='st'>"mu2"</span>, <span class='st'>"sig1"</span>, <span class='st'>"rho"</span>)
<span class='co'>#--- initial proposal distributions</span>
<span class='no'>proposal_sd</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fl'>.4</span>, <span class='fl'>.1</span>, <span class='fl'>.05</span>, <span class='fl'>.1</span> )
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>proposal_sd</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>pars</span>)
<span class='co'>#--- lower and upper bound for parameters</span>
<span class='no'>pars_lower</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( -<span class='fl'>10</span>, -<span class='fl'>10</span>, <span class='fl'>.001</span>, -<span class='fl'>.999</span> )
<span class='no'>pars_upper</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fl'>10</span>, <span class='fl'>10</span>, <span class='fl'>1E100</span>, <span class='fl'>.999</span> )

<span class='co'>#--- define list with derived parameters</span>
<span class='no'>derivedPars</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='st'>"var1"</span><span class='kw'>=</span>~ <span class='fu'><a href='https://rdrr.io/r/base/AsIs.html'>I</a></span>( <span class='no'>sig1</span>^<span class='fl'>2</span> ), <span class='st'>"d1"</span><span class='kw'>=</span>~ <span class='fu'><a href='https://rdrr.io/r/base/AsIs.html'>I</a></span>( ( <span class='no'>mu2</span> - <span class='no'>mu1</span> ) / <span class='no'>sig1</span> ) )

<span class='co'>#*** start Metropolis-Hastings sampling</span>
<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>LAM</span><span class='kw ns'>::</span><span class='fu'>amh</span>( <span class='no'>data</span>, <span class='kw'>nobs</span><span class='kw'>=</span><span class='no'>data</span>$<span class='no'>n</span>, <span class='kw'>pars</span><span class='kw'>=</span><span class='no'>pars</span>, <span class='kw'>model</span><span class='kw'>=</span><span class='no'>model</span>,
          <span class='kw'>prior</span><span class='kw'>=</span><span class='no'>prior</span>, <span class='kw'>proposal_sd</span><span class='kw'>=</span><span class='no'>proposal_sd</span>,
          <span class='kw'>n.iter</span><span class='kw'>=</span><span class='fl'>1000</span>, <span class='kw'>n.burnin</span><span class='kw'>=</span><span class='fl'>300</span>, <span class='kw'>derivedPars</span><span class='kw'>=</span><span class='no'>derivedPars</span>,
          <span class='kw'>pars_lower</span><span class='kw'>=</span><span class='no'>pars_lower</span>, <span class='kw'>pars_upper</span><span class='kw'>=</span><span class='no'>pars_upper</span> )

<span class='co'># some S3 methods</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod</span>)
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>mod</span>, <span class='kw'>ask</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span>(<span class='no'>mod</span>)
<span class='fu'><a href='https://rdrr.io/r/stats/vcov.html'>vcov</a></span>(<span class='no'>mod</span>)
<span class='fu'><a href='https://rdrr.io/r/stats/logLik.html'>logLik</a></span>(<span class='no'>mod</span>)

<span class='co'>#--- compare Bayesian credibility intervals and HPD intervals</span>
<span class='no'>ci</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='fu'><a href='https://rdrr.io/r/stats/confint.html'>confint</a></span>(<span class='no'>mod</span>), <span class='kw pkg'>coda</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/coda/man/HPDinterval.html'>HPDinterval</a></span>(<span class='no'>mod</span>$<span class='no'>mcmcobj</span>)[-<span class='fl'>1</span>, ] )
<span class='no'>ci</span>
<span class='co'># interval lengths</span>
<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='no'>ci</span>[,<span class='fl'>2</span>]-<span class='no'>ci</span>[,<span class='fl'>1</span>], <span class='no'>ci</span>[,<span class='fl'>4</span>] - <span class='no'>ci</span>[,<span class='fl'>3</span>] )

<span class='co'>#--- plot update history of proposal standard deviations</span>
<span class='kw pkg'>graphics</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/matplot.html'>matplot</a></span>( <span class='kw'>x</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>mod</span>$<span class='no'>proposal_sd_history</span>),
          <span class='kw'>y</span><span class='kw'>=</span><span class='no'>mod</span>$<span class='no'>proposal_sd_history</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='st'>"o"</span>, <span class='kw'>pch</span><span class='kw'>=</span><span class='fl'>1</span>:<span class='fl'>6</span>)

<span class='co'>#**** compare results with lavaan package</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>lavaan</span>)
<span class='no'>lavmodel</span> <span class='kw'>&lt;-</span> <span class='st'>"
    F=~ 1*Y1 + 1*Y2 + 1*Y3
    F ~~ rho*F
    Y1 ~~ v1*Y1
    Y2 ~~ v1*Y2
    Y3 ~~ v1*Y3
    Y1 ~ mu1 * 1
    Y2 ~ mu2 * 1
    Y3 ~ mu2 * 1
    # total standard deviation
    sig1 :=sqrt( rho + v1 )
    "</span>
<span class='co'># estimate model</span>
<span class='no'>mod2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>lavaan</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lavaan/man/sem.html'>sem</a></span>( <span class='kw'>data</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span>(<span class='no'>dat</span>), <span class='no'>lavmodel</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod2</span>)
<span class='fu'><a href='https://rdrr.io/r/stats/logLik.html'>logLik</a></span>(<span class='no'>mod2</span>)

<span class='co'>#*** compare results with penalized maximum likelihood estimation</span>
<span class='no'>mod3</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>LAM</span><span class='kw ns'>::</span><span class='fu'>pmle</span>( <span class='kw'>data</span><span class='kw'>=</span><span class='no'>data</span>, <span class='kw'>nobs</span><span class='kw'>=</span><span class='no'>data</span>$<span class='no'>n</span>, <span class='kw'>pars</span><span class='kw'>=</span><span class='no'>pars</span>, <span class='kw'>model</span><span class='kw'>=</span><span class='no'>model</span>,  <span class='kw'>prior</span><span class='kw'>=</span><span class='no'>prior</span>,
            <span class='kw'>pars_lower</span><span class='kw'>=</span><span class='no'>pars_lower</span>, <span class='kw'>pars_upper</span><span class='kw'>=</span><span class='no'>pars_upper</span>, <span class='kw'>verbose</span><span class='kw'>=</span><span class='fl'>TRUE</span>  )
<span class='co'># model summaries</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod3</span>)
<span class='fu'><a href='https://rdrr.io/r/stats/confint.html'>confint</a></span>(<span class='no'>mod3</span>)
<span class='fu'><a href='https://rdrr.io/r/stats/vcov.html'>vcov</a></span>(<span class='no'>mod3</span>)

<span class='co'>#*** penalized likelihood estimation with provided gradient of log-likelihood</span>

<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>CDM</span>)
<span class='no'>fct</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>){
    <span class='fu'>model</span>(<span class='kw'>pars</span><span class='kw'>=</span><span class='no'>x</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>data</span> )
}
<span class='co'># use numerical gradient (just for illustration)</span>
<span class='no'>grad</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>pars</span>){
    <span class='kw pkg'>CDM</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/CDM/man/numerical_Hessian.html'>numerical_Hessian</a></span>(<span class='kw'>par</span><span class='kw'>=</span><span class='no'>pars</span>, <span class='kw'>FUN</span><span class='kw'>=</span><span class='no'>fct</span>, <span class='kw'>gradient</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>hessian</span><span class='kw'>=</span><span class='fl'>FALSE</span>)
}
<span class='co'>#- estimate model</span>
<span class='no'>mod3b</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>LAM</span><span class='kw ns'>::</span><span class='fu'>pmle</span>( <span class='kw'>data</span><span class='kw'>=</span><span class='no'>data</span>, <span class='kw'>nobs</span><span class='kw'>=</span><span class='no'>data</span>$<span class='no'>n</span>, <span class='kw'>pars</span><span class='kw'>=</span><span class='no'>pars</span>, <span class='kw'>model</span><span class='kw'>=</span><span class='no'>model</span>,  <span class='kw'>prior</span><span class='kw'>=</span><span class='no'>prior</span>, <span class='kw'>model_grad</span><span class='kw'>=</span><span class='no'>grad</span>,
            <span class='kw'>pars_lower</span><span class='kw'>=</span><span class='no'>pars_lower</span>, <span class='kw'>pars_upper</span><span class='kw'>=</span><span class='no'>pars_upper</span>, <span class='kw'>verbose</span><span class='kw'>=</span><span class='fl'>TRUE</span>  )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod3b</span>)

<span class='co'>#--- lavaan with covariance and mean vector input</span>
<span class='no'>mod2a</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>lavaan</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lavaan/man/sem.html'>sem</a></span>( <span class='kw'>sample.cov</span><span class='kw'>=</span><span class='no'>data</span>$<span class='no'>S</span>, <span class='kw'>sample.mean</span><span class='kw'>=</span><span class='no'>data</span>$<span class='no'>M</span>, <span class='kw'>sample.nobs</span><span class='kw'>=</span><span class='no'>data</span>$<span class='no'>n</span>,
                <span class='kw'>model</span><span class='kw'>=</span><span class='no'>lavmodel</span> )
<span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span>(<span class='no'>mod2</span>)
<span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span>(<span class='no'>mod2a</span>)

<span class='co'>#--- fit covariance and mean structure by fitting a transformed</span>
<span class='co'>#    covariance structure</span>
<span class='co'>#* create an expanded covariance matrix</span>
<span class='no'>p</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>S</span>)
<span class='no'>S1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='fl'>NA</span>, <span class='kw'>nrow</span><span class='kw'>=</span><span class='no'>p</span>+<span class='fl'>1</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='no'>p</span>+<span class='fl'>1</span> )
<span class='no'>S1</span>[<span class='fl'>1</span>:<span class='no'>p</span>,<span class='fl'>1</span>:<span class='no'>p</span>] <span class='kw'>&lt;-</span> <span class='no'>S</span> + <span class='fu'><a href='https://rdrr.io/r/base/outer.html'>outer</a></span>( <span class='no'>M</span>, <span class='no'>M</span> )
<span class='no'>S1</span>[<span class='no'>p</span>+<span class='fl'>1</span>,<span class='fl'>1</span>:<span class='no'>p</span>] <span class='kw'>&lt;-</span> <span class='no'>S1</span>[<span class='fl'>1</span>:<span class='no'>p</span>, <span class='no'>p</span>+<span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='no'>M</span>
<span class='no'>S1</span>[<span class='no'>p</span>+<span class='fl'>1</span>,<span class='no'>p</span>+<span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>vars</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>S</span>), <span class='st'>"MY"</span> )
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>S1</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>S1</span>) <span class='kw'>&lt;-</span> <span class='no'>vars</span>
<span class='co'>#* lavaan model</span>
<span class='no'>lavmodel</span> <span class='kw'>&lt;-</span> <span class='st'>"
    # indicators
    F=~ 1*Y1 + 1*Y2 + 1*Y3
    # pseudo-indicator representing mean structure
    FM=~ 1*MY
    MY ~~ 0*MY
    FM ~~ 1*FM
    F ~~ 0*FM
    # mean structure
    FM=~ mu1*Y1 + mu2*Y2 + mu2*Y3
    # variance structure
    F ~~ rho*F
    Y1 ~~ v1*Y1
    Y2 ~~ v1*Y2
    Y3 ~~ v1*Y3
    sig1 :=sqrt( rho + v1 )
    "</span>

<span class='co'># estimate model</span>
<span class='no'>mod2b</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>lavaan</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lavaan/man/sem.html'>sem</a></span>( <span class='kw'>sample.cov</span><span class='kw'>=</span><span class='no'>S1</span>,<span class='kw'>sample.nobs</span><span class='kw'>=</span><span class='no'>data</span>$<span class='no'>n</span>,
                <span class='kw'>model</span><span class='kw'>=</span><span class='no'>lavmodel</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod2b</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod2</span>)

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 2: Estimation of a linear model with Box-Cox transformation of response</span>
<span class='co'>#############################################################################</span>

<span class='co'>#*** simulate data with Box-Cox transformation</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>875</span>)
<span class='no'>N</span> <span class='kw'>&lt;-</span> <span class='fl'>1000</span>
<span class='no'>b0</span> <span class='kw'>&lt;-</span> <span class='fl'>1.5</span>
<span class='no'>b1</span> <span class='kw'>&lt;-</span> <span class='fl'>.3</span>
<span class='no'>sigma</span> <span class='kw'>&lt;-</span> <span class='fl'>.5</span>
<span class='no'>lambda</span> <span class='kw'>&lt;-</span> <span class='fl'>0.3</span>
<span class='co'># apply inverse Box-Cox transformation</span>
  <span class='co'># yl=( y^lambda - 1 ) / lambda</span>
  <span class='co'># -&gt; y=( lambda * yl + 1 )^(1/lambda)</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>( <span class='no'>N</span>,  <span class='kw'>mean</span><span class='kw'>=</span><span class='fl'>0</span>, <span class='kw'>sd</span><span class='kw'>=</span><span class='fl'>1</span> )
<span class='no'>yl</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>( <span class='no'>N</span>, <span class='kw'>mean</span><span class='kw'>=</span><span class='no'>b0</span>, <span class='kw'>sd</span><span class='kw'>=</span><span class='no'>sigma</span> ) + <span class='no'>b1</span>*<span class='no'>x</span>
<span class='co'># truncate at zero</span>
<span class='no'>eps</span> <span class='kw'>&lt;-</span> <span class='fl'>.01</span>
<span class='no'>yl</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span>( <span class='no'>yl</span> <span class='kw'>&lt;</span> <span class='no'>eps</span>, <span class='no'>eps</span>, <span class='no'>yl</span> )
<span class='no'>y</span> <span class='kw'>&lt;-</span> ( <span class='no'>lambda</span> * <span class='no'>yl</span> + <span class='fl'>1</span> ) ^(<span class='fl'>1</span>/<span class='no'>lambda</span> )

<span class='co'>#-- display distributions of transformed and untransformed data</span>
   <span class='kw pkg'>graphics</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span>(<span class='kw'>mfrow</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>2</span>))
<span class='kw pkg'>graphics</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span>(<span class='no'>yl</span>, <span class='kw'>breaks</span><span class='kw'>=</span><span class='fl'>20</span>)
<span class='kw pkg'>graphics</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span>(<span class='no'>y</span>, <span class='kw'>breaks</span><span class='kw'>=</span><span class='fl'>20</span>)
   <span class='kw pkg'>graphics</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span>(<span class='kw'>mfrow</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>1</span>))

<span class='co'>#*** define vector of parameters</span>
<span class='no'>pars</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fl'>0</span>, <span class='fl'>0</span>,  <span class='fl'>1</span>, -<span class='fl'>.2</span> )
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>pars</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"b0"</span>, <span class='st'>"b1"</span>, <span class='st'>"sigma"</span>, <span class='st'>"lambda"</span> )
<span class='co'>#*** input data</span>
<span class='no'>data</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='st'>"y"</span><span class='kw'>=</span><span class='no'>y</span>, <span class='st'>"x"</span><span class='kw'>=</span><span class='no'>x</span>)
<span class='co'>#*** define model with log-likelihood function</span>
<span class='no'>model</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>( <span class='no'>pars</span>, <span class='no'>data</span> ){
    <span class='no'>sigma</span> <span class='kw'>&lt;-</span> <span class='no'>pars</span>[<span class='st'>"sigma"</span>]
    <span class='no'>b0</span> <span class='kw'>&lt;-</span> <span class='no'>pars</span>[<span class='st'>"b0"</span>]
    <span class='no'>b1</span> <span class='kw'>&lt;-</span> <span class='no'>pars</span>[<span class='st'>"b1"</span>]
    <span class='no'>lambda</span> <span class='kw'>&lt;-</span> <span class='no'>pars</span>[<span class='st'>"lambda"</span>]
    <span class='kw'>if</span> ( <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span>(<span class='no'>lambda</span>) <span class='kw'>&lt;</span> <span class='fl'>.01</span>){ <span class='no'>lambda</span> <span class='kw'>&lt;-</span> <span class='fl'>.01</span> * <span class='fu'><a href='https://rdrr.io/r/base/sign.html'>sign</a></span>(<span class='no'>lambda</span>) }
    <span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='no'>data</span>$<span class='no'>y</span>
    <span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='no'>data</span>$<span class='no'>x</span>
    <span class='no'>n</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>y</span>)
    <span class='no'>y_lambda</span> <span class='kw'>&lt;-</span> ( <span class='no'>y</span>^<span class='no'>lambda</span> - <span class='fl'>1</span> ) / <span class='no'>lambda</span>
    <span class='no'>ll</span> <span class='kw'>&lt;-</span> - <span class='no'>n</span>/<span class='fl'>2</span> * <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span>(<span class='fl'>2</span>*<span class='no'>pi</span>) - <span class='no'>n</span> * <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span>( <span class='no'>sigma</span> ) -
            <span class='fl'>1</span>/(<span class='fl'>2</span>*<span class='no'>sigma</span>^<span class='fl'>2</span>)* <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>( (<span class='no'>y_lambda</span> - <span class='no'>b0</span> - <span class='no'>b1</span>*<span class='no'>x</span>)^<span class='fl'>2</span> ) +
            ( <span class='no'>lambda</span> - <span class='fl'>1</span> ) * <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span>( <span class='no'>y</span> ) )
    <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(<span class='no'>ll</span>)
}
<span class='co'>#-- test model function</span>
<span class='fu'>model</span>( <span class='no'>pars</span>, <span class='no'>data</span> )

<span class='co'>#*** define prior distributions</span>
<span class='no'>prior</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>()
<span class='no'>prior</span><span class='kw'>[[</span><span class='st'>"b0"</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='st'>"dnorm"</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>x</span><span class='kw'>=</span><span class='fl'>NA</span>, <span class='kw'>mean</span><span class='kw'>=</span><span class='fl'>0</span>, <span class='kw'>sd</span><span class='kw'>=</span><span class='fl'>10</span> ) )
<span class='no'>prior</span><span class='kw'>[[</span><span class='st'>"b1"</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='st'>"dnorm"</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>x</span><span class='kw'>=</span><span class='fl'>NA</span>, <span class='kw'>mean</span><span class='kw'>=</span><span class='fl'>0</span>, <span class='kw'>sd</span><span class='kw'>=</span><span class='fl'>10</span> ) )
<span class='no'>prior</span><span class='kw'>[[</span><span class='st'>"sigma"</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='st'>"dunif"</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>x</span><span class='kw'>=</span><span class='fl'>NA</span>, <span class='fl'>0</span>, <span class='fl'>10</span>  ) )
<span class='no'>prior</span><span class='kw'>[[</span><span class='st'>"lambda"</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='st'>"dunif"</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>x</span><span class='kw'>=</span><span class='fl'>NA</span>, -<span class='fl'>2</span>, <span class='fl'>2</span> ) )
<span class='co'>#*** define proposal SDs</span>
<span class='no'>proposal_sd</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fl'>.1</span>, <span class='fl'>.1</span>, <span class='fl'>.1</span>, <span class='fl'>.1</span> )
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>proposal_sd</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>pars</span>)
<span class='co'>#*** define bounds for parameters</span>
<span class='no'>pars_lower</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( -<span class='fl'>100</span>, -<span class='fl'>100</span>, <span class='fl'>.01</span>, -<span class='fl'>2</span> )
<span class='no'>pars_upper</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fl'>100</span>, <span class='fl'>100</span>, <span class='fl'>100</span>, <span class='fl'>2</span> )

<span class='co'>#*** sampling routine</span>
<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>LAM</span><span class='kw ns'>::</span><span class='fu'>amh</span>( <span class='no'>data</span>, <span class='kw'>nobs</span><span class='kw'>=</span><span class='no'>N</span>, <span class='no'>pars</span>, <span class='no'>model</span>,  <span class='no'>prior</span>, <span class='no'>proposal_sd</span>,
        <span class='kw'>n.iter</span><span class='kw'>=</span><span class='fl'>10000</span>, <span class='kw'>n.burnin</span><span class='kw'>=</span><span class='fl'>2000</span>, <span class='kw'>n.sims</span><span class='kw'>=</span><span class='fl'>5000</span>,
        <span class='kw'>pars_lower</span><span class='kw'>=</span><span class='no'>pars_lower</span>, <span class='kw'>pars_upper</span><span class='kw'>=</span><span class='no'>pars_upper</span> )
<span class='co'>#-- S3 methods</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod</span>)
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>mod</span>, <span class='kw'>ask</span><span class='kw'>=</span><span class='fl'>TRUE</span> )

<span class='co'>#*** estimating Box-Cox transformation in MASS package</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>MASS</span>)
<span class='no'>mod2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>MASS</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/MASS/man/boxcox.html'>boxcox</a></span>( <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span>( <span class='no'>y</span> ~ <span class='no'>x</span> ), <span class='kw'>lambda</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(-<span class='fl'>1</span>,<span class='fl'>2</span>,<span class='kw'>length</span><span class='kw'>=</span><span class='fl'>100</span>) )
<span class='no'>mod2</span>$<span class='no'>x</span>[ <span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span>( <span class='no'>mod2</span>$<span class='no'>y</span> ) ]

<span class='co'>#*** estimate Box-Cox parameter lambda with car package</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>car</span>)
<span class='no'>mod3</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>car</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/car/man/powerTransform.html'>powerTransform</a></span>( <span class='no'>y</span> ~ <span class='no'>x</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod3</span>)
<span class='co'># fit linear model with transformed response</span>
<span class='no'>mod3a</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span>( <span class='kw pkg'>car</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/car/man/bcPower.html'>bcPower</a></span>( <span class='no'>y</span>, <span class='no'>mod3</span>$<span class='no'>roundlam</span>) ~ <span class='no'>x</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod3a</span>)

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 3: STARTS model directly specified in LAM or lavaan</span>
<span class='co'>#############################################################################</span>

<span class='co'>## Data from Wu (2016)</span>

<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>LAM</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>sirt</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>STARTS</span>)

<span class='co'>## define list with input data</span>
<span class='co'>## S ... covariance matrix, M ... mean vector</span>

<span class='co'># read covariance matrix of data in Wu (older cohort, positive affect)</span>
<span class='no'>S</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fl'>12.745</span>, <span class='fl'>7.046</span>, <span class='fl'>6.906</span>, <span class='fl'>6.070</span>, <span class='fl'>5.047</span>, <span class='fl'>6.110</span>,
    <span class='fl'>7.046</span>, <span class='fl'>14.977</span>, <span class='fl'>8.334</span>, <span class='fl'>6.714</span>, <span class='fl'>6.91</span>, <span class='fl'>6.624</span>,
    <span class='fl'>6.906</span>, <span class='fl'>8.334</span>, <span class='fl'>13.323</span>, <span class='fl'>7.979</span>, <span class='fl'>8.418</span>, <span class='fl'>7.951</span>,
    <span class='fl'>6.070</span>, <span class='fl'>6.714</span>, <span class='fl'>7.979</span>, <span class='fl'>12.041</span>, <span class='fl'>7.874</span>, <span class='fl'>8.099</span>,
    <span class='fl'>5.047</span>, <span class='fl'>6.91</span>, <span class='fl'>8.418</span>, <span class='fl'>7.874</span>, <span class='fl'>13.838</span>, <span class='fl'>9.117</span>,
    <span class='fl'>6.110</span>, <span class='fl'>6.624</span>, <span class='fl'>7.951</span>, <span class='fl'>8.099</span>, <span class='fl'>9.117</span>, <span class='fl'>15.132</span> ),
    <span class='kw'>nrow</span><span class='kw'>=</span><span class='fl'>6</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>6</span>, <span class='kw'>byrow</span><span class='kw'>=</span><span class='fl'>TRUE</span> )
<span class='co'>#* standardize S such that the average SD is 1 (for ease of interpretation)</span>
<span class='no'>M_SD</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>(<span class='no'>S</span>) ))
<span class='no'>S</span> <span class='kw'>&lt;-</span> <span class='no'>S</span> / <span class='no'>M_SD</span>^<span class='fl'>2</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>S</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>S</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>(<span class='st'>"W"</span>,<span class='fl'>1</span>:<span class='fl'>6</span>)
<span class='no'>W</span> <span class='kw'>&lt;-</span> <span class='fl'>6</span>   <span class='co'># number of measurement waves</span>
<span class='no'>data</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='st'>"S"</span><span class='kw'>=</span><span class='no'>S</span>, <span class='st'>"M"</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>0</span>,<span class='no'>W</span>), <span class='st'>"n"</span><span class='kw'>=</span><span class='fl'>660</span>, <span class='st'>"W"</span><span class='kw'>=</span><span class='no'>W</span>  )

<span class='co'>#*** likelihood function for the STARTS model</span>
<span class='no'>model</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>( <span class='no'>pars</span>, <span class='no'>data</span> ){
    <span class='co'># mean vector</span>
    <span class='no'>mu</span> <span class='kw'>&lt;-</span> <span class='no'>data</span>$<span class='no'>M</span>
    <span class='co'># covariance matrix</span>
    <span class='no'>W</span> <span class='kw'>&lt;-</span> <span class='no'>data</span>$<span class='no'>W</span>
    <span class='no'>var_trait</span> <span class='kw'>&lt;-</span> <span class='no'>pars</span>[<span class='st'>"vt"</span>]
    <span class='no'>var_ar</span> <span class='kw'>&lt;-</span> <span class='no'>pars</span>[<span class='st'>"va"</span>]
    <span class='no'>var_state</span> <span class='kw'>&lt;-</span> <span class='no'>pars</span>[<span class='st'>"vs"</span>]
    <span class='no'>a</span> <span class='kw'>&lt;-</span> <span class='no'>pars</span>[<span class='st'>"b"</span>]
    <span class='no'>Sigma</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>STARTS</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/STARTS/man/starts_uni.html'>starts_uni_cov</a></span>( <span class='kw'>W</span><span class='kw'>=</span><span class='no'>W</span>, <span class='kw'>var_trait</span><span class='kw'>=</span><span class='no'>var_trait</span>,
                <span class='kw'>var_ar</span><span class='kw'>=</span><span class='no'>var_ar</span>, <span class='kw'>var_state</span><span class='kw'>=</span><span class='no'>var_state</span>, <span class='kw'>a</span><span class='kw'>=</span><span class='no'>a</span> )
    <span class='co'># evaluate log-likelihood</span>
    <span class='no'>ll</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>LAM</span><span class='kw ns'>::</span><span class='fu'><a href='loglike_mvnorm.html'>loglike_mvnorm</a></span>( <span class='kw'>S</span><span class='kw'>=</span><span class='no'>data</span>$<span class='no'>S</span>, <span class='kw'>Sigma</span><span class='kw'>=</span><span class='no'>Sigma</span>, <span class='kw'>M</span><span class='kw'>=</span><span class='no'>data</span>$<span class='no'>M</span>, <span class='kw'>mu</span><span class='kw'>=</span><span class='no'>mu</span>,
                <span class='kw'>n</span><span class='kw'>=</span><span class='no'>data</span>$<span class='no'>n</span>, <span class='kw'>lambda</span><span class='kw'>=</span><span class='fl'>1E-5</span>)
    <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(<span class='no'>ll</span>)
}
<span class='co'>#** Note:</span>
<span class='co'>#   (1) The function starts_uni_cov calculates the model implied covariance matrix</span>
<span class='co'>#       for the STARTS model.</span>
<span class='co'>#   (2) The function loglike_mvnorm evaluates the loglikelihood for a multivariate</span>
<span class='co'>#       normal distribution given sample and population means M and mu, and sample</span>
<span class='co'>#       and population covariance matrix S and Sigma.</span>

<span class='co'>#*** starting values for parameters</span>
<span class='no'>pars</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fl'>.33</span>, <span class='fl'>.33</span>, <span class='fl'>.33</span>, <span class='fl'>.75</span>)
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>pars</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"vt"</span>,<span class='st'>"va"</span>,<span class='st'>"vs"</span>,<span class='st'>"b"</span>)
<span class='co'>#*** bounds for acceptance rates</span>
<span class='no'>acceptance_bounds</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fl'>.45</span>, <span class='fl'>.55</span> )
<span class='co'>#*** starting values for proposal standard deviations</span>
<span class='no'>proposal_sd</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fl'>.1</span>, <span class='fl'>.1</span>, <span class='fl'>.1</span>, <span class='fl'>.1</span> )
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>proposal_sd</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>pars</span>)
<span class='co'>#*** lower and upper bounds for parameter estimates</span>
<span class='no'>pars_lower</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fl'>.001</span>, <span class='fl'>.001</span>, <span class='fl'>.001</span>, <span class='fl'>.001</span> )
<span class='no'>pars_upper</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fl'>10</span>, <span class='fl'>10</span>, <span class='fl'>10</span>, <span class='fl'>.999</span> )
<span class='co'>#*** define prior distributions | use prior sample size of 3</span>
<span class='no'>prior_model</span> <span class='kw'>&lt;-</span> <span class='st'>"
    vt ~ dinvgamma2(NA, 3, .33 )
    va ~ dinvgamma2(NA, 3, .33 )
    vs ~ dinvgamma2(NA, 3, .33 )
    b ~ dbeta(NA, 4, 4 )
        "</span>
<span class='co'>#*** define number of iterations</span>
<span class='no'>n.burnin</span> <span class='kw'>&lt;-</span> <span class='fl'>5000</span>
<span class='no'>n.iter</span> <span class='kw'>&lt;-</span> <span class='fl'>20000</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>987</span>)    <span class='co'># fix random seed</span>
<span class='co'>#*** estimate model with 'LAM::amh' function</span>
<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>LAM</span><span class='kw ns'>::</span><span class='fu'>amh</span>( <span class='kw'>data</span><span class='kw'>=</span><span class='no'>data</span>, <span class='kw'>nobs</span><span class='kw'>=</span><span class='no'>data</span>$<span class='no'>n</span>, <span class='kw'>pars</span><span class='kw'>=</span><span class='no'>pars</span>, <span class='kw'>model</span><span class='kw'>=</span><span class='no'>model</span>,
            <span class='kw'>prior</span><span class='kw'>=</span><span class='no'>prior_model</span>, <span class='kw'>proposal_sd</span><span class='kw'>=</span><span class='no'>proposal_sd</span>, <span class='kw'>n.iter</span><span class='kw'>=</span><span class='no'>n.iter</span>,
            <span class='kw'>n.burnin</span><span class='kw'>=</span><span class='no'>n.burnin</span>, <span class='kw'>pars_lower</span><span class='kw'>=</span><span class='no'>pars_lower</span>, <span class='kw'>pars_upper</span><span class='kw'>=</span><span class='no'>pars_upper</span>)
<span class='co'>#*** model summary</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod</span>)
  <span class='co'>##  Parameter Summary (Marginal MAP estimation)</span>
  <span class='co'>##    parameter   MAP    SD  Q2.5 Q97.5  Rhat SERatio effSize accrate</span>
  <span class='co'>##  1        vt 0.352 0.088 0.122 0.449 1.014   0.088     128   0.557</span>
  <span class='co'>##  2        va 0.335 0.080 0.238 0.542 1.015   0.090     123   0.546</span>
  <span class='co'>##  3        vs 0.341 0.018 0.297 0.367 1.005   0.042     571   0.529</span>
  <span class='co'>##  4         b 0.834 0.065 0.652 0.895 1.017   0.079     161   0.522</span>
  <span class='co'>##</span>
  <span class='co'>##  Comparison of Different Estimators</span>
  <span class='co'>##</span>
  <span class='co'>##  MAP: Univariate marginal MAP estimation</span>
  <span class='co'>##  mMAP: Multivariate MAP estimation (penalized likelihood estimate)</span>
  <span class='co'>##  Mean: Mean of posterior distributions</span>
  <span class='co'>##</span>
  <span class='co'>##    Parameter Summary:</span>
  <span class='co'>##    parm   MAP  mMAP  Mean</span>
  <span class='co'>##  1   vt 0.352 0.294 0.300</span>
  <span class='co'>##  2   va 0.335 0.371 0.369</span>
  <span class='co'>##  3   vs 0.341 0.339 0.335</span>
  <span class='co'>##  4    b 0.834 0.822 0.800</span>

<span class='co'>#* inspect convergence</span>
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>mod</span>, <span class='kw'>ask</span><span class='kw'>=</span><span class='fl'>TRUE</span>)

<span class='co'>#---------------------------</span>
<span class='co'># fitting the STARTS model with penalized maximum likelihood estimation</span>
<span class='no'>mod2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>LAM</span><span class='kw ns'>::</span><span class='fu'>pmle</span>( <span class='kw'>data</span><span class='kw'>=</span><span class='no'>data</span>, <span class='kw'>nobs</span><span class='kw'>=</span><span class='no'>data</span>$<span class='no'>n</span>, <span class='kw'>pars</span><span class='kw'>=</span><span class='no'>pars</span>, <span class='kw'>model</span><span class='kw'>=</span><span class='no'>model</span>,  <span class='kw'>prior</span><span class='kw'>=</span><span class='no'>prior_model</span>,
            <span class='kw'>pars_lower</span><span class='kw'>=</span><span class='no'>pars_lower</span>, <span class='kw'>pars_upper</span><span class='kw'>=</span><span class='no'>pars_upper</span>, <span class='kw'>method</span><span class='kw'>=</span><span class='st'>"L-BFGS-B"</span>,
            <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>trace</span><span class='kw'>=</span><span class='fl'>TRUE</span> )  )
<span class='co'># model summaries</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod2</span>)
  <span class='co'>##  Parameter Summary</span>
  <span class='co'>##    parameter   est    se      t     p active</span>
  <span class='co'>##  1        vt 0.298 0.110  2.712 0.007      1</span>
  <span class='co'>##  2        va 0.364 0.102  3.560 0.000      1</span>
  <span class='co'>##  3        vs 0.337 0.018 18.746 0.000      1</span>
  <span class='co'>##  4         b 0.818 0.074 11.118 0.000      1</span>

<span class='co'>#---------------------------</span>
<span class='co'># fitting the STARTS model in lavaan</span>

<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>lavaan</span>)

<span class='co'>## define lavaan model</span>
<span class='no'>lavmodel</span> <span class='kw'>&lt;-</span> <span class='st'>[1059 chars quoted with '"']</span>
<span class='co'># estimate lavaan model</span>
<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>lavaan</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lavaan/man/lavaan.html'>lavaan</a></span>(<span class='kw'>model</span><span class='kw'>=</span><span class='no'>lavmodel</span>, <span class='kw'>sample.cov</span><span class='kw'>=</span><span class='no'>S</span>, <span class='kw'>sample.nobs</span><span class='kw'>=</span><span class='fl'>660</span>)
<span class='co'># summary and fit measures</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod</span>)
<span class='kw pkg'>lavaan</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lavaan/man/fitMeasures.html'>fitMeasures</a></span>(<span class='no'>mod</span>)
<span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span>(<span class='no'>mod</span>)[ ! <span class='fu'><a href='https://rdrr.io/r/base/duplicated.html'>duplicated</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span>(<span class='no'>mod</span>))) ]
  <span class='co'>##           vt          vs           b          va          v1</span>
  <span class='co'>##  0.001000023 0.349754630 0.916789054 0.651723144 0.103948711</span>
}</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Alexander Robitzsch.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


